import{u as $,a as F,r as d,j as e}from"./index-BjbuOfvE.js";function B(){const{user:l,logout:A}=$(),r=F(),[f,E]=d.useState([]),[S,x]=d.useState(!1),[v,h]=d.useState(""),[j,k]=d.useState(1),w=5;d.useEffect(()=>{(!l||!l.token)&&r("/login")},[l,r]);const g=async()=>{if(!(!l||!l.token)){x(!0),h("");try{const t=await fetch("https://thevyans.politebeach-89ca2b50.centralindia.azurecontainerapps.io/posts",{headers:{Authorization:`Bearer ${l.token}`}});if(t.status===401){r("/login");return}const a=await t.json();t.ok?E(a.sort((n,o)=>o._id.localeCompare(n._id))):h(a.message||"Failed to fetch posts")}catch(t){h(t.message)}finally{x(!1)}}};d.useEffect(()=>{g()},[l,r]);const L=async t=>{if(window.confirm("Are you sure you want to delete this post?"))try{const a=await fetch(`https://thevyans.politebeach-89ca2b50.centralindia.azurecontainerapps.io/posts/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${l.token}`}});if(a.status===401){r("/login");return}const n=await a.json();a.ok?g():alert("Error deleting post: "+n.message)}catch(a){alert("Error deleting post: "+a.message)}},[s,c]=d.useState({title:"",date:"",author:"",content:"",images:[],videos:[]}),[m,N]=d.useState(!1),[i,y]=d.useState({image:null,englishContent:"",hindiContent:""}),[p,C]=d.useState(!1),u=t=>{c({...s,[t.target.name]:t.target.value})},D=t=>{c({...s,images:Array.from(t.target.files)})},R=t=>{t.preventDefault();const a=s.videoInput?.trim();a&&c({...s,videos:[...s.videos,a],videoInput:""})},I=t=>{c({...s,videoInput:t.target.value})},U=t=>{c({...s,images:s.images.filter((a,n)=>n!==t)})},z=t=>{c({...s,videos:s.videos.filter((a,n)=>n!==t)})},_=async t=>{t.preventDefault(),N(!0);const a=new FormData;a.append("title",s.title),a.append("date",s.date),a.append("author",s.author),a.append("content",s.content),s.images.forEach((n,o)=>{a.append("images",n)}),s.videos.forEach((n,o)=>{a.append("videos",n)});try{const n=await fetch("https://thevyans.politebeach-89ca2b50.centralindia.azurecontainerapps.io/post",{method:"POST",headers:{Authorization:`Bearer ${l.token}`},body:a}),o=await n.json();if(n.status===401){r("/login");return}n.ok?(alert(`Post submitted!
`+JSON.stringify(o,null,2)),c({title:"",date:"",author:"",content:"",images:[],videos:[],videoInput:""}),g()):alert("Error submitting post: "+o.message)}catch(n){alert("Error submitting post: "+n.message)}finally{N(!1)}},b=t=>{const{name:a,value:n,type:o,files:T}=t.target;y(o==="file"?{...i,image:T[0]}:{...i,[a]:n})},O=async t=>{t.preventDefault(),C(!0);const a=new FormData;a.append("englishContent",i.englishContent),a.append("hindiContent",i.hindiContent),i.image&&a.append("image",i.image);try{const n=await fetch("https://thevyans.politebeach-89ca2b50.centralindia.azurecontainerapps.io/about",{method:"PUT",headers:{Authorization:`Bearer ${l.token}`},body:a}),o=await n.json();if(n.status===401){r("/login");return}n.ok?alert(`About section updated!
`+JSON.stringify(o,null,2)):alert("Error updating about section: "+o.message)}catch(n){alert("Error updating about section: "+n.message)}finally{C(!1)}},P=f.slice(0,j*w);return e.jsxs("div",{className:"admin-panel-container",children:[e.jsxs("div",{className:"admin-panel-header-actions",children:[e.jsx("button",{className:"admin-panel-btn",onClick:()=>r("/"),children:"Go to Homepage"}),e.jsx("button",{className:"admin-panel-btn",onClick:A,children:"Logout"})]}),e.jsx("h1",{className:"admin-panel-title",children:"Admin Panel"}),e.jsxs("div",{className:"admin-panel-sections",children:[e.jsxs("section",{className:"admin-panel-section",children:[e.jsx("h2",{className:"admin-panel-section-title",children:"Upload New Post"}),e.jsxs("form",{className:"admin-panel-form",onSubmit:_,children:[e.jsx("input",{className:"admin-panel-input",type:"text",name:"title",placeholder:"Title",value:s.title,onChange:u,required:!0}),e.jsx("input",{className:"admin-panel-input",type:"text",name:"date",placeholder:"Date (e.g. June 2024)",value:s.date,onChange:u}),e.jsx("input",{className:"admin-panel-input",type:"text",name:"author",placeholder:"Author",value:s.author,onChange:u}),e.jsx("textarea",{className:"admin-panel-textarea",name:"content",placeholder:"Content",value:s.content,onChange:u}),e.jsx("div",{className:"admin-panel-media-group",children:e.jsx("input",{className:"admin-panel-input",type:"file",multiple:!0,accept:"image/*",onChange:D,disabled:m})}),e.jsx("div",{className:"admin-panel-media-list",children:s.images.map((t,a)=>e.jsxs("div",{className:"admin-panel-media-item",children:[e.jsx("img",{src:typeof t=="string"?t:URL.createObjectURL(t),alt:`img${a}`,className:"admin-panel-thumb"}),e.jsx("button",{type:"button",className:"admin-panel-remove-btn",onClick:()=>U(a),disabled:m,children:"Remove"})]},a))}),e.jsxs("div",{className:"admin-panel-media-group",children:[e.jsx("input",{className:"admin-panel-input",type:"url",placeholder:"YouTube Share Link",name:"videoInput",value:s.videoInput||"",onChange:I,disabled:m}),e.jsx("button",{type:"button",className:"admin-panel-btn",onClick:R,disabled:m,children:"Add Video"})]}),e.jsx("div",{className:"admin-panel-media-list",children:s.videos.map((t,a)=>e.jsxs("div",{className:"admin-panel-media-item",children:[e.jsx("span",{className:"admin-panel-video-url",children:t}),e.jsx("button",{type:"button",className:"admin-panel-remove-btn",onClick:()=>z(a),disabled:m,children:"Remove"})]},a))}),e.jsx("button",{type:"submit",className:"admin-panel-submit-btn",disabled:m,children:m?"Submitting...":"Submit Post"})]})]}),e.jsxs("section",{className:"admin-panel-section",children:[e.jsx("h2",{className:"admin-panel-section-title",children:"Edit About Section"}),e.jsxs("form",{className:"admin-panel-form",onSubmit:O,children:[e.jsx("input",{className:"admin-panel-input",type:"file",name:"image",accept:"image/*",onChange:b,required:!0,disabled:p}),i.image&&typeof i.image=="object"&&e.jsx("img",{src:URL.createObjectURL(i.image),alt:"Preview",style:{maxWidth:"120px",margin:"10px 0"}}),e.jsx("textarea",{className:"admin-panel-textarea",name:"englishContent",placeholder:"English Content",value:i.englishContent,onChange:b,required:!0,disabled:p}),e.jsx("textarea",{className:"admin-panel-textarea",name:"hindiContent",placeholder:"Hindi Content",value:i.hindiContent,onChange:b,required:!0,disabled:p}),e.jsx("button",{type:"submit",className:"admin-panel-submit-btn",disabled:p,children:p?"Updating...":"Update About"})]})]}),e.jsxs("section",{className:"admin-panel-section",children:[e.jsx("h2",{className:"admin-panel-section-title",children:"All Posts"}),S?e.jsx("div",{children:"Loading posts..."}):v?e.jsx("div",{style:{color:"red"},children:v}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"admin-panel-posts-list",children:P.map(t=>e.jsxs("li",{className:"admin-panel-posts-list-item",children:[e.jsx("span",{className:"admin-panel-post-title",children:t.title}),e.jsx("button",{className:"admin-panel-remove-btn",onClick:()=>L(t._id),children:"Delete"})]},t._id))}),f.length>P.length&&e.jsx("button",{className:"admin-panel-btn admin-panel-more-btn",onClick:()=>k(j+1),children:"More"})]})]})]})]})}export{B as default};
